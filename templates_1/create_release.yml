# ===================================================================================
# ==                 README: Create Release - Step Template                      ==
# ===================================================================================
#
# CORRECTION (Auto Project Name):
# The 'microserviceProjectName' parameter has been REMOVED. This template now uses
# the built-in Azure DevOps variable '$(System.TeamProject)' to automatically
# determine the project name. This makes the calling pipeline simpler and more robust.
#
# ===================================================================================

parameters:
- name: repositoryName # Now only needs the repository name
  type: string

steps:
- task: Bash@3
  displayName: 'Configure Git Identity'
  # ... (script is the same)
- task: Bash@3
  displayName: 'Install Versioning Tools'
  # ... (script is the same)
- task: Bash@3
  displayName: 'Clone & Sync Repo'
  inputs:
    env: { GIT_TOKEN: $(System.AccessToken) }
    script: |
      set -e
      # The project name is now taken from a built-in variable.
      PROJECT_NAME_ENCODED=$(echo "$(System.TeamProject)" | sed 's/ /%20/g')
      REPO_URL="https://x-token-auth:$(GIT_TOKEN)@dev.azure.com/YourOrgName/${PROJECT_NAME_ENCODED}/_git/${{ parameters.repositoryName }}"
      git clone "$REPO_URL" service-repo
      cd service-repo
      git fetch --all --tags
      git checkout main
      git reset --hard origin/main
      git checkout dev
      git reset --hard origin/dev
- task: Bash@3
  displayName: 'Calculate Next Version'
  # ... (script is the same)
- task: Bash@3
  displayName: 'Create and Push Release Branch'
  # ... (script is the same)